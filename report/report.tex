\documentclass{llncs}

\usepackage{microtype}
\usepackage{xspace}

\newcommand{\KeY}{Ke\kern-1ptY\xspace}

\title{The \KeY Approach on Hagrid
  \\{\small VerifyThis Long-Term Challenge 2020 }}

\author{ Stijn de Gouw \and Mattias Ulbrich \and Alexander Weigl }
\institute{Open University \and Karlsruhe Institute of Technology}
\begin{document}
\maketitle

\section{Introduction}

1. Motivation

2. VerifyThis Challenge LTC

3. Verification target 

For 2020, the challenge system is the new, implementation of the PGP server
infrastructure, called HAGRID [2]. The old implementation did not conform to
GDPR and was known to be vulnerable against DoS attacks.
    

   % * ... the used verification approach and tools
   %  * ... how the challenge was adapted to make verification possible
   %    (abstractions, reimplementation, different behaviour)
   %  * ... what has been achieved (modelled and verified properties)
   %  * ... successes and challenges encountered in the course of the case
   %    study.

\section{Introduction of the \KeY tool}

Deductive Verification of Java Programs; Supports Java 1.4 and JavaCard;
ultimate precise tool; requires a lot of specification and effort but guarantees
correctness;


\section{Re-implementation of Hagrid in Java}

how the challenge was adapted to make verification possible
(abstractions, reimplementation, different behaviour)

1. We need to reimplement in Java.

2. Decided for a simple implementation, one class only.

3. We verify two different version,

a. a simplified version without the use of any complex methods

b. a complex, map-based version.

4. 

\paragraph{A simple email-key map}

The most basic version is a simplified implementation for the keyserver -- verifiable without interactions in KeY, based on five integer arrays that store for each user:

\begin{itemize}
\item the id/email of the user, represented currently by an integer
\item two arrays for confirmed and unconfirmed keys, and
\item an array that stores confirmation codes.
\item an array that stores which operation was most recently requested (the implementation only allows to confirm that operation)
\end{itemize}
The maximum number of users is fixed to 1024, as the arrays are never resized. The table below shows the main metrics:

\begin{center}
\begin{tabular}{ |c|c|c| } 
 \hline
 Lines of Code & Lines of Specs & Proof Steps \\
 \hline
 69 & 82 & 30.119 \\
 \hline
\end{tabular}
\end{center}

% proof stats:
% addConfirm: 2665+2549
% addRequest: 5710
% delConfirm: 8321+2480
% delRequest: 2478+1212
% get: 1830
% posOfId: 2874


We also attempted to add a `timeout' mechanism, to cover the following aspect of the challenge:
\begin{quote}
If the provided code \emph{is one recently issued} then the corresponding operation (addition/removal) is finalised
\end{quote}
This is easy to add in the implementation: first store the time that the user requests the operation (in an additional array), and when confirming, only approve the operation if that time was sufficiently recent. But it is problematic for specification and verification: the timelimit may not yet have elapsed in the precondition (i.e. the specification), but it may have when the JVM determines the current time in the \verb|confirm| method body.
So we dropped the timeout aspect.

\paragraph{Map version}

The next version builds upon the generalization of the previous map structure.
It is currently work in progress. This is a two-step process. The first step is
a provable version using maps of int to int. This avoids working with the heap.

KIMap (Key Integer Map) is an interface representing a map of Int -> Int. This
functionality is bound to the behaviour of the map data type in KeY by JML
specification. KIMapImpl is a simple implementation based upon two int arrays,
one for the key, the other the values. KeyServerInt is a version of the backend
of the verifying key server using integers as e-mail addresses and keys. The
second step is to use Strings. This results into KSMap and KSMapImpl and also
the KeyServerString.

\section{Proofed Properties}

what has been achieved (modelled and verified properties)


\section{Conclusion }

.. successes and challenges encountered in the course of the case study.

\end{document}
